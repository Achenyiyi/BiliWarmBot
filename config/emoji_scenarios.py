"""B站官方表情包场景化配置模块 - 优化版

根据情感类型、场景和紧急程度，智能选择最合适的 B 站官方表情。
表情选择遵循"情感共鸣"原则，通过视觉符号增强文字的情感表达力。

更新说明：
- 基于B站官方免费表情整理（89个）
- 根据互联网实际语义重新分类
- 每个场景扩展至12-15个表情，更丰富多样
"""

# 情感类型到表情场景的映射
# 将细粒度情感归类到 6 大表情场景
EMOTION_TO_SCENARIO = {
    # 悲伤类 -> 悲伤共情
    "悲伤": "悲伤共情",
    "难过": "悲伤共情",
    "痛苦": "心疼理解",
    "伤心": "悲伤共情",
    "哭泣": "悲伤共情",
    "绝望": "心疼理解",
    "失落": "悲伤共情",
    "心碎": "心疼理解",
    "emo": "悲伤共情",
    "破防": "悲伤共情",
    "泪目": "悲伤共情",
    
    # 焦虑类 -> 安慰陪伴
    "焦虑": "安慰陪伴",
    "担心": "安慰陪伴",
    "害怕": "安慰陪伴",
    "紧张": "安慰陪伴",
    "压力大": "鼓励加油",
    "内耗": "安慰陪伴",
    "不安": "安慰陪伴",
    "恐惧": "安慰陪伴",
    "恐慌": "安慰陪伴",
    
    # 孤独类 -> 安慰陪伴
    "孤独": "安慰陪伴",
    "寂寞": "安慰陪伴",
    "没人理解": "心疼理解",
    "被孤立": "心疼理解",
    "不合群": "心疼理解",
    "空虚": "安慰陪伴",
    
    # 愤怒类 -> 安慰陪伴（需要安抚）
    "愤怒": "安慰陪伴",
    "生气": "安慰陪伴",
    "不满": "安慰陪伴",
    "怨恨": "安慰陪伴",
    "委屈": "心疼理解",
    "气愤": "安慰陪伴",
    "恼火": "安慰陪伴",
    
    # 迷茫类 -> 鼓励加油
    "迷茫": "鼓励加油",
    "困惑": "鼓励加油",
    "没方向": "鼓励加油",
    "无意义": "鼓励加油",
    "倦怠": "鼓励加油",
    "疲惫": "鼓励加油",
    "累": "鼓励加油",
    "无力": "鼓励加油",
    "躺平": "轻松幽默",
    "摆烂": "轻松幽默",
    
    # 自卑/外貌焦虑 -> 鼓励加油
    "自卑": "鼓励加油",
    "不自信": "鼓励加油",
    "外貌焦虑": "鼓励加油",
    "身材焦虑": "鼓励加油",
    "颜值焦虑": "鼓励加油",
    "自我怀疑": "鼓励加油",
    
    # 生育/育儿 -> 心疼理解
    "产后抑郁": "心疼理解",
    "育儿压力": "鼓励加油",
    "生育焦虑": "安慰陪伴",
    
    # 网络暴力 -> 心疼理解
    "被网暴": "心疼理解",
    "被骂": "心疼理解",
    "舆论压力": "安慰陪伴",
    "被误解": "心疼理解",
    
    # 积极类（用户情绪好转）-> 温暖治愈
    "感谢": "温暖治愈",
    "开心": "温暖治愈",
    "感动": "温暖治愈",
    "希望": "鼓励加油",
    "好转": "温暖治愈",
    "幸福": "温暖治愈",
    "温暖": "温暖治愈",
    "治愈": "温暖治愈",
    
    # 默认
    "其他": "安慰陪伴"
}

# 场景化表情配置 - 使用 B 站官方免费表情
# 根据互联网实际使用语义分类
SCENARIO_EMOJIS = {
    "悲伤共情": {
        "description": "真诚共情、陪伴悲伤",
        "emojis": [
            "[委屈]",    # 可怜、受委屈
            "[大哭]",    # 伤心大哭
            "[流泪]",    # 难过流泪
            "[难过]",    # 不开心
            "[酸了]",    # 心酸、羡慕
            "[捂脸]",    # 无奈、尴尬
            "[笑哭]",    # 哭笑不得（无奈）
            "[生病]",    # 难受
            "[疼]",      # 心痛
            "[无语]",    # 说不出话
            "[囧]",      # 尴尬无奈
            "[尴尬]",    # 窘迫
        ],
        "weights": [0.18, 0.15, 0.13, 0.12, 0.10, 0.09, 0.08, 0.06, 0.04, 0.03, 0.01, 0.01]
    },

    "心疼理解": {
        "description": "深度理解、感同身受",
        "emojis": [
            "[委屈]",    # 心疼
            "[酸了]",    # 心酸
            "[大哭]",    # 心疼到哭
            "[难过]",    # 为你难过
            "[生病]",    # 心疼你
            "[疼]",      # 感同身受的痛
            "[拥抱]",    # 抱抱
            "[给心心]",  # 给你爱
            "[爱心]",    # 关心
            "[害羞]",    # 温柔的关心
            "[捂脸]",    # 无奈的心疼
            "[灵魂出窍]", # 累瘫（理解你的累）
            "[吓]",      # 被你的遭遇吓到
            "[囧]",      # 无语的心疼
        ],
        "weights": [0.15, 0.13, 0.12, 0.11, 0.10, 0.09, 0.09, 0.08, 0.06, 0.03, 0.02, 0.01, 0.01, 0.01]
    },

    "安慰陪伴": {
        "description": "温柔陪伴、给予支持",
        "emojis": [
            "[拥抱]",    # 抱抱
            "[给心心]",  # 给你爱
            "[爱心]",    # 关心
            "[害羞]",    # 温柔的陪伴
            "[脸红]",    # 真诚的关心
            "[惊喜]",    # 想给你惊喜
            "[微笑]",    # 温暖的笑
            "[偷笑]",    # 轻松的陪伴
            "[嘟嘟]",    # 可爱的安慰
            "[藏狐]",    # 淡定的陪伴（我在）
            "[酸了]",    # 心疼你
            "[生气]",    # 为你生气（站你这边）
            "[怒]",      # 愤怒的支持
        ],
        "weights": [0.16, 0.14, 0.12, 0.11, 0.10, 0.09, 0.08, 0.07, 0.05, 0.04, 0.02, 0.01, 0.01]
    },

    "鼓励加油": {
        "description": "给予力量、支持鼓励",
        "emojis": [
            "[奋斗]",    # 加油奋斗
            "[打call]",  # 为你应援
            "[支持]",    # 力挺
            "[点赞]",    # 你很棒
            "[墨镜]",    # 酷、自信
            "[胜利]",    # 你会赢的
            "[加油]",    # 加油
            "[OK]",      # 没问题
            "[酷]",      # 你很酷
            "[妙啊]",    # 你很棒
            "[歪嘴]",    # 自信（你也可以）
            "[给心心]",  # 爱你支持你
            "[爱心]",    # 给你力量
            "[星星眼]",  # 看好你
            "[惊喜]",    # 期待你的好消息
        ],
        "weights": [0.14, 0.13, 0.12, 0.11, 0.10, 0.09, 0.08, 0.07, 0.06, 0.04, 0.03, 0.02, 0.01, 0.01, 0.01]
    },

    "温暖治愈": {
        "description": "温暖、治愈、阳光",
        "emojis": [
            "[给心心]",  # 爱
            "[喜欢]",    # 喜欢
            "[爱心]",    # 爱心
            "[星星眼]",  # 期待
            "[惊喜]",    # 惊喜
            "[害羞]",    # 温暖
            "[脸红]",    # 心动
            "[微笑]",    # 微笑
            "[笑]",      # 开心
            "[大笑]",    # 大笑
            "[偷笑]",    # 窃喜
            "[呲牙]",    # 开心
            "[喜极而泣]", # 感动
            "[哦呼]",    # 赞叹
            "[嘟嘟]",    # 可爱
        ],
        "weights": [0.14, 0.12, 0.11, 0.11, 0.10, 0.09, 0.08, 0.07, 0.06, 0.05, 0.03, 0.02, 0.01, 0.01, 0.01]
    },

    "轻松幽默": {
        "description": "缓解气氛、轻松调侃",
        "emojis": [
            "[doge]",    # 调侃、反讽
            "[妙啊]",    # 机智
            "[脱单doge]", # 恋爱调侃
            "[吃瓜]",    # 围观
            "[嗑瓜子]",  # 看戏
            "[滑稽]",    # 调皮
            "[歪嘴]",    # 拽
            "[嫌弃]",    # 鄙视（轻松）
            "[嫌弃脸]",  # 鄙视
            "[疑惑]",    # 问号
            "[辣眼睛]",  # 不忍直视
            "[调皮]",    # 顽皮
            "[藏狐]",    # 淡定
            "[笑哭]",    # 无奈笑
            "[偷笑]",    # 偷着乐
        ],
        "weights": [0.16, 0.13, 0.11, 0.10, 0.09, 0.09, 0.08, 0.06, 0.04, 0.03, 0.03, 0.02, 0.02, 0.01, 0.01]
    }
}

# 特殊场景的表情选择
SPECIAL_SCENARIOS = {
    "紧急危机": {
        "description": "涉及自杀、自残等紧急情况",
        "emojis": [
            "[拥抱]",    # 抱抱
            "[给心心]",  # 给你爱
            "[爱心]",    # 关心
            "[委屈]",    # 心疼
            "[大哭]",    # 为你难过
            "[难过]",    # 担心
        ],
        "weights": [0.25, 0.20, 0.18, 0.15, 0.12, 0.10]
    }
}


def get_emoji_for_emotion(emotion: str, is_emergency: bool = False) -> str:
    """
    根据情感类型获取合适的表情
    
    Args:
        emotion: 情感类型
        is_emergency: 是否是紧急情况
    
    Returns:
        表情代码，如 "[拥抱]"
    """
    import random
    
    # 紧急情况优先处理
    if is_emergency:
        scenario = SPECIAL_SCENARIOS["紧急危机"]
        return random.choices(scenario["emojis"], weights=scenario["weights"])[0]
    
    # 根据情感类型获取场景
    scenario_name = EMOTION_TO_SCENARIO.get(emotion, "安慰陪伴")
    scenario = SCENARIO_EMOJIS.get(scenario_name, SCENARIO_EMOJIS["安慰陪伴"])
    
    # 根据权重随机选择
    return random.choices(scenario["emojis"], weights=scenario["weights"])[0]


def get_emoji_for_sentiment(sentiment_score: float, emotion: str = "其他") -> str:
    """
    根据情感分数获取表情（使用全部6个场景）
    
    情感分数映射规则：
    - 0.85+：极度负面，深度共情（心疼理解）
    - 0.70-0.85：非常负面，悲伤共情（悲伤共情）
    - 0.55-0.70：比较负面，需要鼓励（鼓励加油）
    - 0.40-0.55：中等负面，陪伴安慰（安慰陪伴）
    - 0.25-0.40：轻微负面，温暖治愈（温暖治愈）
    - <0.25：积极或中性，轻松幽默（轻松幽默）
    
    Args:
        sentiment_score: 情感分数 0-1
        emotion: 情感类型（备用）
    
    Returns:
        表情代码
    """
    import random
    
    # 根据分数选择场景（6档映射）
    if sentiment_score >= 0.85:
        scenario = SCENARIO_EMOJIS["心疼理解"]
    elif sentiment_score >= 0.70:
        scenario = SCENARIO_EMOJIS["悲伤共情"]
    elif sentiment_score >= 0.55:
        scenario = SCENARIO_EMOJIS["鼓励加油"]
    elif sentiment_score >= 0.40:
        scenario = SCENARIO_EMOJIS["安慰陪伴"]
    elif sentiment_score >= 0.25:
        scenario = SCENARIO_EMOJIS["温暖治愈"]
    else:
        scenario = SCENARIO_EMOJIS["轻松幽默"]
    
    return random.choices(scenario["emojis"], weights=scenario["weights"])[0]


# 验证所有表情是否都是 B 站官方支持的
VALID_EMOJIS = set()
for scenario in SCENARIO_EMOJIS.values():
    VALID_EMOJIS.update(scenario["emojis"])
for scenario in SPECIAL_SCENARIOS.values():
    VALID_EMOJIS.update(scenario["emojis"])

if __name__ == "__main__":
    # 模块自测
    print("表情场景化配置测试（优化版）：\n")
    
    test_emotions = ["悲伤", "焦虑", "孤独", "愤怒", "迷茫", "感谢", "其他"]
    
    for emotion in test_emotions:
        scenario = EMOTION_TO_SCENARIO.get(emotion, "安慰陪伴")
        emoji = get_emoji_for_emotion(emotion)
        print(f"情感 '{emotion}' -> 场景 '{scenario}' -> 表情 {emoji}")
    
    print("\n特殊场景：")
    print(f"紧急情况: {get_emoji_for_emotion('悲伤', is_emergency=True)}")
    
    print("\n情感分数测试（6档映射）：")
    test_scores = [0.9, 0.75, 0.6, 0.48, 0.35, 0.15]
    for score in test_scores:
        emoji = get_emoji_for_sentiment(score)
        if score >= 0.85:
            level = "心疼理解"
        elif score >= 0.70:
            level = "悲伤共情"
        elif score >= 0.55:
            level = "鼓励加油"
        elif score >= 0.40:
            level = "安慰陪伴"
        elif score >= 0.25:
            level = "温暖治愈"
        else:
            level = "轻松幽默"
        print(f"分数 {score}: {level} -> {emoji}")
    
    print(f"\n总计可用表情: {len(VALID_EMOJIS)} 个")
    print("表情列表:", " ".join(sorted(VALID_EMOJIS)))
